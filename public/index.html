<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>YouTube Video Timestamp</title>
</head>

<body>
    <h1>YouTube Video Timestamp</h1>
    <div>
        <input type="text" name="youtube-url" id="youtube-url">
        <button id="get-video">GetVideo</button>
    </div>
    <br>
    <div>
        <iframe id="player" type="text/html" width="640" height="360"
            src="https://www.youtube.com/embed/CU38gUD1GBA?enablejsapi=1" frameborder="0"></iframe>
    </div>
    <p>Current time: <span id="timestamp"></span></p>

    <br>
    <div>
        <ul>
            <li>
                Start Time: <b id="start-time"></b>
            </li>
            <li>
                End Time: <b id="end-time"></b>
            </li>
        </ul>
    </div>
    <br>
    <div>
        <button id="start">Start</button>
        <button id="end">End</button>
    </div>
</body>
<script>
    var startTime
    var endTime
    var tag = document.createElement('script');
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        event.target.playVideo();
        setInterval(function () {
            var currentTime = event.target.getCurrentTime();
            var timestamp = formatTimestamp(currentTime);
            document.getElementById('timestamp').innerHTML = timestamp;
        }, 1000);
    }

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            setInterval(function () {
                var currentTime = event.target.getCurrentTime();
                var timestamp = formatTimestamp(currentTime);
                document.getElementById('timestamp').innerHTML = timestamp;
            }, 1000);
        }
    }

    function formatTimestamp(time) {
        var minutes = Math.floor(time / 60);
        var seconds = Math.floor(time - minutes * 60);
        return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
    }

    function convertToEmbedUrl(shareUrl) {
        // Check if the share URL is a valid YouTube URL
        var regex = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
        var match = shareUrl.match(regex);

        if (match) {
            var videoId = match[4];

            // Generate the embed URL
            var embedUrl = "https://www.youtube.com/embed/" + videoId + "?enablejsapi=1";

            return embedUrl;
        } else {
            // Invalid URL
            return null;
        }
    }

    //get video
    var myButton = document.getElementById("get-video");
    myButton.onclick = function () {
        var youtubeUrl = document.getElementById('youtube-url').value
        embedUrl = convertToEmbedUrl(youtubeUrl)
        document.getElementById('player').src = embedUrl

    };


    //record start
    var myButton = document.getElementById("start");
    myButton.onclick = function () {
        startTime = document.getElementById('timestamp').innerHTML
        document.getElementById('start-time').innerHTML = startTime
    };

    //record end
    var myButton = document.getElementById("end");
    myButton.onclick = function () {
        endTime = document.getElementById('timestamp').innerHTML
        document.getElementById('end-time').innerHTML = endTime

    };




</script>

</html>
